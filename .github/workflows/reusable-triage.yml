# Reusable Triage Workflow
# Use this workflow in your repositories to enable AI-powered triage
#
# Usage in your repo's .github/workflows/triage.yml:
#
#   name: Triage
#   on:
#     issues:
#       types: [opened]
#     workflow_dispatch:
#       inputs:
#         command:
#           type: choice
#           options: [assess, sprint, roadmap, security, cascade]
#   jobs:
#     triage:
#       uses: jbdevprimary/agentic-triage/.github/workflows/reusable-triage.yml@main
#       with:
#         command: ${{ github.event.inputs.command || 'assess' }}
#         issue: ${{ github.event.issue.number }}
#       secrets:
#         github_token: ${{ secrets.CI_GITHUB_TOKEN }}
#         ollama_api_key: ${{ secrets.OLLAMA_API_KEY }}

name: Reusable Triage

on:
  workflow_call:
    inputs:
      command:
        description: 'Triage command (assess, label, review, sprint, roadmap, security, cascade)'
        required: true
        type: string
      issue:
        description: 'Issue number'
        required: false
        type: string
      pr:
        description: 'PR number'
        required: false
        type: string
      repo:
        description: 'Target repository (defaults to caller repo)'
        required: false
        type: string
    secrets:
      github_token:
        description: 'GitHub token with repo access'
        required: true
      ollama_api_key:
        description: 'Ollama Cloud API key'
        required: true

jobs:
  triage:
    name: Run Triage
    runs-on: ubuntu-latest
    steps:
      - name: Run agentic-triage
        uses: jbcom/nodejs-agentic-triage@c7cb1ef533972cd759f19af230f8b4250b8a19aa
        with:
          command: ${{ inputs.command }}
          issue: ${{ inputs.issue }}
          pr: ${{ inputs.pr }}
          repo: ${{ inputs.repo || github.repository }}
          github_token: ${{ secrets.github_token }}
          ollama_api_key: ${{ secrets.ollama_api_key }}
